

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>polygen.polygen2d.plotting &mdash; polygen 1.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
    <link rel="canonical" href="https://Rumi381.github.io/polygen/_modules/polygen/polygen2d/plotting.html" />
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=6efca38a"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/custom.js?v=14139ab5"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            polygen
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">polygen</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">polygen</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">polygen.polygen2d.plotting</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for polygen.polygen2d.plotting</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">Point</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.extractVoronoiEdges</span><span class="w"> </span><span class="kn">import</span> <span class="n">VoronoiEdgeExtractor</span>

<div class="viewcode-block" id="get_figure_size">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.get_figure_size">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate figure size in inches based on journal specifications.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    layout : str</span>
<span class="sd">        Layout type (&#39;single&#39;, &#39;1x2&#39;, &#39;1x3&#39;, &#39;2x2&#39;, &#39;2x3&#39;, &#39;3x2&#39;, &#39;3x3&#39;).</span>
<span class="sd">    journal_type : str</span>
<span class="sd">        Journal size (&#39;large&#39; or &#39;small&#39;).</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        Figure size in inches (width, height).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mm_to_inches</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">25.4</span>  <span class="c1"># Conversion factor from mm to inches</span>

    <span class="c1"># Journal-specific dimensions</span>
    <span class="k">if</span> <span class="n">journal_type</span> <span class="o">==</span> <span class="s1">&#39;large&#39;</span><span class="p">:</span>
        <span class="n">single_column</span> <span class="o">=</span> <span class="mi">84</span> <span class="o">*</span> <span class="n">mm_to_inches</span>  <span class="c1"># 84 mm width for single column</span>
        <span class="n">double_column</span> <span class="o">=</span> <span class="mi">174</span> <span class="o">*</span> <span class="n">mm_to_inches</span>  <span class="c1"># 174 mm width for double column</span>
        <span class="n">max_height</span> <span class="o">=</span> <span class="mi">234</span> <span class="o">*</span> <span class="n">mm_to_inches</span>  <span class="c1"># Max height: 234 mm</span>
    <span class="k">elif</span> <span class="n">journal_type</span> <span class="o">==</span> <span class="s1">&#39;small&#39;</span><span class="p">:</span>
        <span class="n">single_column</span> <span class="o">=</span> <span class="mi">119</span> <span class="o">*</span> <span class="n">mm_to_inches</span>  <span class="c1"># 119 mm width for single column</span>
        <span class="n">double_column</span> <span class="o">=</span> <span class="mi">119</span> <span class="o">*</span> <span class="n">mm_to_inches</span>  <span class="c1"># Use single-column width for all</span>
        <span class="n">max_height</span> <span class="o">=</span> <span class="mi">195</span> <span class="o">*</span> <span class="n">mm_to_inches</span>  <span class="c1"># Max height: 195 mm</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;journal_type must be &#39;large&#39; or &#39;small&#39;.&quot;</span><span class="p">)</span>

    <span class="c1"># Aspect ratio constants</span>
    <span class="n">aspect_ratios</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;single&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>  <span class="c1"># Standard 4:3 for single plot</span>
        <span class="s1">&#39;1x2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>     <span class="c1"># Wider for 1x2 (16:6 or 8:3)</span>
        <span class="s1">&#39;1x3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>    <span class="c1"># Very wide for 1x3</span>
        <span class="s1">&#39;2x2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>     <span class="c1"># Square for 2x2</span>
        <span class="s1">&#39;2x3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>     <span class="c1"># Moderate height for 2x3</span>
        <span class="s1">&#39;3x2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>     <span class="c1"># Taller for 3x2</span>
        <span class="s1">&#39;3x3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>      <span class="c1"># Square for 3x3</span>
    <span class="p">}</span>

    <span class="c1"># Get aspect ratio for the layout</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">aspect_ratios</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">aspect_ratios</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">])</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">ratio</span>

    <span class="c1"># Scale width and height to fit the journal&#39;s column width</span>
    <span class="k">if</span> <span class="n">layout</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">single_column</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">double_column</span>
    <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Ensure height doesn&#39;t exceed maximum allowed</span>
    <span class="n">height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">max_height</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span></div>

 
<div class="viewcode-block" id="set_publication_style">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.set_publication_style">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_publication_style</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure matplotlib for publication-quality figures following journal guidelines.</span>
<span class="sd">    </span>
<span class="sd">    Key requirements implemented:</span>
<span class="sd">    - Vector graphics (saved as EPS)</span>
<span class="sd">    - Helvetica/Arial font</span>
<span class="sd">    - Consistent font sizing (8-12pt)</span>
<span class="sd">    - Minimum line width 0.3pt</span>
<span class="sd">    - No titles within figures</span>
<span class="sd">    - Proper figure dimensions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
    
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Font settings</span>
        <span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font.sans-serif&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">],</span>  <span class="c1"># As per guidelines</span>
        <span class="s1">&#39;text.usetex&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Disable LaTeX to ensure font consistency</span>
        
        <span class="c1"># Font sizes (8-12pt as specified)</span>
        <span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        
        <span class="c1"># Line widths (minimum 0.3pt = 0.1mm)</span>
        <span class="s1">&#39;axes.linewidth&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="s1">&#39;grid.linewidth&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="s1">&#39;lines.linewidth&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="s1">&#39;xtick.major.width&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="s1">&#39;ytick.major.width&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
        
        <span class="c1"># Figure settings</span>
        <span class="s1">&#39;figure.dpi&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>        <span class="c1"># For line art</span>
        <span class="s1">&#39;savefig.dpi&#39;</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span>      <span class="c1"># For line art</span>
        <span class="s1">&#39;savefig.bbox&#39;</span><span class="p">:</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span>
        <span class="s1">&#39;savefig.pad_inches&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        
        <span class="c1"># Other settings</span>
        <span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.3</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>  <span class="c1"># 84mm width (single column) at 72 dpi</span>
        <span class="s1">&#39;figure.autolayout&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></div>


<span class="c1"># Ploting the domain with the seed points (if provided)</span>
<div class="viewcode-block" id="plot_boundary_with_points">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.plot_boundary_with_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_boundary_with_points</span><span class="p">(</span>
    <span class="n">polygon</span><span class="p">,</span>
    <span class="n">figure_name</span><span class="p">,</span>
    <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">exterior_color</span><span class="o">=</span><span class="s1">&#39;#1B365D&#39;</span><span class="p">,</span>
    <span class="n">exterior_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">interior_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">interior_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">line_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
    <span class="n">point_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">point_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">point_marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="n">margins</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
    <span class="n">show_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot polygon boundaries with optional seed points.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    polygon : shapely.geometry.Polygon or shapely.geometry.MultiPolygon</span>
<span class="sd">        The polygon(s) to be plotted. Can be either a single polygon or multiple polygons.</span>
<span class="sd">    figure_name : str</span>
<span class="sd">        Name of the output figure. If no extension is provided, &#39;.png&#39; is used.</span>
<span class="sd">    points : numpy.ndarray, optional</span>
<span class="sd">        Array of points with shape (n, 2) containing x, y coordinates.</span>
<span class="sd">    show_figure : bool, optional</span>
<span class="sd">        Whether to display the figure, by default True.</span>
<span class="sd">    exterior_color : str, optional</span>
<span class="sd">        Color for exterior boundaries. Can use shorthand or full name.</span>
<span class="sd">        Common shorthands: &#39;k&#39; (black), &#39;r&#39; (red), &#39;b&#39; (blue), &#39;g&#39; (green),</span>
<span class="sd">        &#39;y&#39; (yellow), &#39;m&#39; (magenta), &#39;c&#39; (cyan), &#39;w&#39; (white).</span>
<span class="sd">        Default is &#39;k&#39;.</span>
<span class="sd">    exterior_style : str, optional</span>
<span class="sd">        Line style for exterior boundaries. Options: [&#39;-&#39;, &#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">        Default is &#39;-&#39; (solid).</span>
<span class="sd">    interior_color : str, optional</span>
<span class="sd">        Color for interior boundaries. Same color options as exterior_color.</span>
<span class="sd">        Default is &#39;r&#39;.</span>
<span class="sd">    interior_style : str, optional</span>
<span class="sd">        Line style for interior boundaries. Same options as exterior_style.</span>
<span class="sd">        Default is &#39;-&#39; (solid).</span>
<span class="sd">    line_width : float, optional</span>
<span class="sd">        Width of all boundary lines, by default 0.5.</span>
<span class="sd">    point_color : str, optional</span>
<span class="sd">        Color for points. Same color options as exterior_color.</span>
<span class="sd">        Default is &#39;blue&#39;.</span>
<span class="sd">    point_size : float, optional</span>
<span class="sd">        Size of points, by default 0.5.</span>
<span class="sd">    point_alpha : float, optional</span>
<span class="sd">        Transparency of points (0 to 1), by default 1.0.</span>
<span class="sd">    point_marker : str, optional</span>
<span class="sd">        Marker style for points. Common options: &#39;o&#39; (circle), &#39;s&#39; (square),</span>
<span class="sd">        &#39;^&#39; (triangle up), &#39;v&#39; (triangle down), &#39;*&#39; (star).</span>
<span class="sd">        Default is &#39;o&#39;.</span>
<span class="sd">    margins : float or tuple, optional</span>
<span class="sd">        Margins around the plot. Can be:</span>
<span class="sd">        - Single float for same margins in x and y</span>
<span class="sd">        - Tuple (x_margin, y_margin) for different margins</span>
<span class="sd">        Default is 0.01 (1% margin in both x and y).</span>
<span class="sd">    dpi : int, optional</span>
<span class="sd">        Resolution of saved figure in dots per inch, by default 1200.</span>
<span class="sd">    show_axes : bool, optional</span>
<span class="sd">        Whether to show axes and ticks, by default False.</span>
<span class="sd">    output_dir : str, optional</span>
<span class="sd">        Directory to save the figure, by default &#39;Plots&#39;.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function automatically creates the output directory if it doesn&#39;t exist.</span>
<span class="sd">    Uses the publication style settings from set_publication_style().</span>
<span class="sd">    </span>
<span class="sd">    Color specifications can use either shorthand (e.g., &#39;k&#39;, &#39;r&#39;, &#39;b&#39;) or </span>
<span class="sd">    full names (e.g., &#39;black&#39;, &#39;red&#39;, &#39;blue&#39;). Additional valid color names </span>
<span class="sd">    include standard colors like &#39;navy&#39;, &#39;forestgreen&#39;, &#39;darkred&#39;, etc.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from shapely.geometry import Polygon</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; # Create a simple triangle</span>
<span class="sd">    &gt;&gt;&gt; polygon = Polygon([(0, 0), (1, 0), (0.5, 1)])</span>
<span class="sd">    &gt;&gt;&gt; # Create some random points</span>
<span class="sd">    &gt;&gt;&gt; points = np.random.rand(10, 2)</span>
<span class="sd">    &gt;&gt;&gt; # Plot with custom styling</span>
<span class="sd">    &gt;&gt;&gt; plot_boundary_with_points(</span>
<span class="sd">    ...     polygon,</span>
<span class="sd">    ...     &#39;triangle_plot&#39;,</span>
<span class="sd">    ...     points=points,</span>
<span class="sd">    ...     exterior_color=&#39;b&#39;,  # or &#39;blue&#39;</span>
<span class="sd">    ...     interior_color=&#39;darkred&#39;,</span>
<span class="sd">    ...     exterior_style=&#39;--&#39;,</span>
<span class="sd">    ...     point_color=&#39;forestgreen&#39;,</span>
<span class="sd">    ...     point_size=1.0</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="n">valid_line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">exterior_style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span> <span class="ow">or</span> <span class="n">interior_style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line styles must be one of: </span><span class="si">{</span><span class="n">valid_line_styles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;points must be a numpy array with shape (n, 2)&quot;</span><span class="p">)</span>

    <span class="c1"># Setup</span>
    <span class="n">set_publication_style</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># Set margins</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Convert single polygon to list for consistent handling</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">polygon</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">)</span> <span class="k">else</span> <span class="n">polygon</span><span class="o">.</span><span class="n">geoms</span>

    <span class="c1"># Plot boundaries</span>
    <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">:</span>
        <span class="c1"># Plot exterior</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">exterior_color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">exterior_style</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>
        
        <span class="c1"># Plot interiors</span>
        <span class="k">for</span> <span class="n">interior</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">interior</span><span class="o">.</span><span class="n">xy</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="n">interior_color</span><span class="p">,</span>
                   <span class="n">linestyle</span><span class="o">=</span><span class="n">interior_style</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>

    <span class="c1"># Plot points if provided</span>
    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span>
            <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="n">point_marker</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">point_alpha</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

    <span class="c1"># Handle axes visibility</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Handle figure saving</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">figure_name</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
        <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1"># Plotting the original Voronoi cells </span>
<div class="viewcode-block" id="plot_voronoi_cells">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.plot_voronoi_cells">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_voronoi_cells</span><span class="p">(</span>
    <span class="n">voronoi_cells</span><span class="p">,</span>
    <span class="n">figure_name</span><span class="p">,</span>
    <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cell_color</span><span class="o">=</span><span class="s1">&#39;#1B365D&#39;</span><span class="p">,</span>
    <span class="n">cell_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">line_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
    <span class="n">point_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">point_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">point_marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="n">margins</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
    <span class="n">show_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot Voronoi cells with optional seed points.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    voronoi_cells : list</span>
<span class="sd">        List of shapely.geometry.Polygon or shapely.geometry.MultiPolygon objects</span>
<span class="sd">        representing the Voronoi cells.</span>
<span class="sd">    figure_name : str</span>
<span class="sd">        Name of the output figure. If no extension is provided, &#39;.png&#39; is used.</span>
<span class="sd">    points : numpy.ndarray, optional</span>
<span class="sd">        Array of points with shape (n, 2) containing x, y coordinates.</span>
<span class="sd">    show_figure : bool, optional</span>
<span class="sd">        Whether to display the figure, by default True.</span>
<span class="sd">    cell_color : str, optional</span>
<span class="sd">        Color for Voronoi cell boundaries. Can use shorthand or full name.</span>
<span class="sd">        Common shorthands: &#39;k&#39; (black), &#39;r&#39; (red), &#39;b&#39; (blue), &#39;g&#39; (green),</span>
<span class="sd">        &#39;y&#39; (yellow), &#39;m&#39; (magenta), &#39;c&#39; (cyan), &#39;w&#39; (white).</span>
<span class="sd">        Default is &#39;k&#39;.</span>
<span class="sd">    cell_style : str, optional</span>
<span class="sd">        Line style for cell boundaries. Options: [&#39;-&#39;, &#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">        Default is &#39;-&#39; (solid).</span>
<span class="sd">    line_width : float, optional</span>
<span class="sd">        Width of cell boundary lines, by default 0.5.</span>
<span class="sd">    point_color : str, optional</span>
<span class="sd">        Color for points. Same color options as cell_color.</span>
<span class="sd">        Default is &#39;blue&#39;.</span>
<span class="sd">    point_size : float, optional</span>
<span class="sd">        Size of points, by default 0.5.</span>
<span class="sd">    point_alpha : float, optional</span>
<span class="sd">        Transparency of points (0 to 1), by default 1.0.</span>
<span class="sd">    point_marker : str, optional</span>
<span class="sd">        Marker style for points. Common options: &#39;o&#39; (circle), &#39;s&#39; (square),</span>
<span class="sd">        &#39;^&#39; (triangle up), &#39;v&#39; (triangle down), &#39;*&#39; (star).</span>
<span class="sd">        Default is &#39;o&#39;.</span>
<span class="sd">    margins : float or tuple, optional</span>
<span class="sd">        Margins around the plot. Can be:</span>
<span class="sd">        - Single float for same margins in x and y</span>
<span class="sd">        - Tuple (x_margin, y_margin) for different margins</span>
<span class="sd">        Default is 0 (1% margin in both x and y).</span>
<span class="sd">    dpi : int, optional</span>
<span class="sd">        Resolution of saved figure in dots per inch, by default 1200.</span>
<span class="sd">    show_axes : bool, optional</span>
<span class="sd">        Whether to show axes and ticks, by default False.</span>
<span class="sd">    output_dir : str, optional</span>
<span class="sd">        Directory to save the figure, by default &#39;Plots&#39;.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function automatically creates the output directory if it doesn&#39;t exist.</span>
<span class="sd">    Uses the publication style settings from set_publication_style().</span>
<span class="sd">    </span>
<span class="sd">    Color specifications can use either shorthand (e.g., &#39;k&#39;, &#39;r&#39;, &#39;b&#39;) or </span>
<span class="sd">    full names (e.g., &#39;black&#39;, &#39;red&#39;, &#39;blue&#39;). Additional valid color names </span>
<span class="sd">    include standard colors like &#39;navy&#39;, &#39;forestgreen&#39;, &#39;darkred&#39;, etc.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Create some Voronoi cells and points</span>
<span class="sd">    &gt;&gt;&gt; cells = [Polygon(...), Polygon(...)]  # List of Voronoi cell polygons</span>
<span class="sd">    &gt;&gt;&gt; points = np.array([[0, 0], [1, 1]])   # Seed points</span>
<span class="sd">    &gt;&gt;&gt; # Plot with custom styling</span>
<span class="sd">    &gt;&gt;&gt; plot_voronoi_cells(</span>
<span class="sd">    ...     cells,</span>
<span class="sd">    ...     &#39;voronoi_plot&#39;,</span>
<span class="sd">    ...     points=points,</span>
<span class="sd">    ...     cell_color=&#39;navy&#39;,</span>
<span class="sd">    ...     cell_style=&#39;--&#39;,</span>
<span class="sd">    ...     point_color=&#39;r&#39;,</span>
<span class="sd">    ...     point_size=1.0</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="n">valid_line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cell_style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line style must be one of: </span><span class="si">{</span><span class="n">valid_line_styles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;points must be a numpy array with shape (n, 2)&quot;</span><span class="p">)</span>

    <span class="c1"># Setup</span>
    <span class="n">set_publication_style</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># Set margins</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Plot cells</span>
    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">voronoi_cells</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
            <span class="n">polygons</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">geoms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell</span><span class="p">]</span>
            
        <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> 
                   <span class="n">color</span><span class="o">=</span><span class="n">cell_color</span><span class="p">,</span>
                   <span class="n">linestyle</span><span class="o">=</span><span class="n">cell_style</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>

    <span class="c1"># Plot points if provided</span>
    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span>
            <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="n">point_marker</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">point_alpha</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

    <span class="c1"># Handle axes visibility</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Handle figure saving</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">figure_name</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
        <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1"># Plot the extracted edges of the Voronoi cells</span>
<div class="viewcode-block" id="plot_voronoi_edges">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.plot_voronoi_edges">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_voronoi_edges</span><span class="p">(</span>
   <span class="n">voronoi_cells</span><span class="p">,</span>
   <span class="n">base_figure</span><span class="p">,</span>
   <span class="n">original_cells</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
   <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
   <span class="n">boundary_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
   <span class="n">boundary_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
   <span class="n">internal_color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
   <span class="n">internal_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
   <span class="n">line_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
   <span class="n">margins</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
   <span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
   <span class="n">show_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
   <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;Plot and save figures showing the whole Voronoi region, boundary edges,</span>
<span class="sd">   and internal edges.</span>

<span class="sd">   Parameters</span>
<span class="sd">   ----------</span>
<span class="sd">   voronoi_cells : list</span>
<span class="sd">       List of shapely.geometry.Polygon objects representing clipped Voronoi cells.</span>
<span class="sd">   base_figure : str</span>
<span class="sd">       Base name for the output figures. If no extension provided, &#39;.png&#39; is used.</span>
<span class="sd">       Three files will be created with suffixes: &#39;_whole&#39;, &#39;_boundary&#39;, &#39;_internal&#39;.</span>
<span class="sd">   original_cells : list, optional</span>
<span class="sd">       List of shapely.geometry.Polygon objects representing original Voronoi cells.</span>
<span class="sd">       If None, edge extraction will be performed only on voronoi_cells.</span>
<span class="sd">   show_figure : bool, optional</span>
<span class="sd">       Whether to display the figures, by default True.</span>
<span class="sd">   boundary_color : str, optional</span>
<span class="sd">       Color for boundary edges. Can use shorthand or full name.</span>
<span class="sd">       Common shorthands: &#39;k&#39; (black), &#39;r&#39; (red), &#39;b&#39; (blue), &#39;g&#39; (green).</span>
<span class="sd">       Default is &#39;r&#39;.</span>
<span class="sd">   boundary_style : str, optional</span>
<span class="sd">       Line style for boundary edges. Options: [&#39;-&#39;, &#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">       Default is &#39;-&#39; (solid).</span>
<span class="sd">   internal_color : str, optional</span>
<span class="sd">       Color for internal edges. Same color options as boundary_color.</span>
<span class="sd">       Default is &#39;b&#39;.</span>
<span class="sd">   internal_style : str, optional</span>
<span class="sd">       Line style for internal edges. Same options as boundary_style.</span>
<span class="sd">       Default is &#39;-&#39; (solid).</span>
<span class="sd">   line_width : float, optional</span>
<span class="sd">       Width of all edge lines, by default 0.5.</span>
<span class="sd">   margins : float or tuple, optional</span>
<span class="sd">       Margins around the plot. Can be:</span>
<span class="sd">       - Single float for same margins in x and y</span>
<span class="sd">       - Tuple (x_margin, y_margin) for different margins</span>
<span class="sd">       Default is 0.01 (1% margin in both x and y).</span>
<span class="sd">   dpi : int, optional</span>
<span class="sd">       Resolution of saved figures in dots per inch, by default 1200.</span>
<span class="sd">   show_axes : bool, optional</span>
<span class="sd">       Whether to show axes and ticks, by default False.</span>
<span class="sd">   output_dir : str, optional</span>
<span class="sd">       Directory to save the figures, by default &#39;Plots&#39;.</span>

<span class="sd">   Notes</span>
<span class="sd">   -----</span>
<span class="sd">   The function creates three separate figures:</span>
<span class="sd">   1. [basename]_whole: Complete Voronoi diagram</span>
<span class="sd">   2. [basename]_boundary: Only boundary edges</span>
<span class="sd">   3. [basename]_internal: Only internal edges</span>

<span class="sd">   The function automatically creates the output directory if it doesn&#39;t exist.</span>
<span class="sd">   Uses the publication style settings from set_publication_style().</span>

<span class="sd">   Color specifications can use either shorthand (e.g., &#39;k&#39;, &#39;r&#39;, &#39;b&#39;) or </span>
<span class="sd">   full names (e.g., &#39;black&#39;, &#39;red&#39;, &#39;blue&#39;).</span>

<span class="sd">   Examples</span>
<span class="sd">   --------</span>
<span class="sd">   &gt;&gt;&gt; # Create Voronoi cells</span>
<span class="sd">   &gt;&gt;&gt; voronoi_cells = [Polygon(...), Polygon(...)]</span>
<span class="sd">   &gt;&gt;&gt; # Plot with default edge extraction</span>
<span class="sd">   &gt;&gt;&gt; plot_voronoi_edges(</span>
<span class="sd">   ...     voronoi_cells,</span>
<span class="sd">   ...     &#39;voronoi_diagram&#39;,</span>
<span class="sd">   ...     boundary_color=&#39;darkred&#39;,</span>
<span class="sd">   ...     internal_color=&#39;navy&#39;</span>
<span class="sd">   ... )</span>
<span class="sd">   &gt;&gt;&gt; </span>
<span class="sd">   &gt;&gt;&gt; # Plot with original cells for edge comparison</span>
<span class="sd">   &gt;&gt;&gt; original_cells = [Polygon(...), Polygon(...)]</span>
<span class="sd">   &gt;&gt;&gt; plot_voronoi_edges(</span>
<span class="sd">   ...     voronoi_cells,</span>
<span class="sd">   ...     &#39;voronoi_diagram&#39;,</span>
<span class="sd">   ...     original_cells=original_cells,</span>
<span class="sd">   ...     boundary_color=&#39;darkred&#39;,</span>
<span class="sd">   ...     internal_color=&#39;navy&#39;</span>
<span class="sd">   ... )</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># Input validation</span>
   <span class="n">valid_line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
   <span class="k">if</span> <span class="n">boundary_style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span> <span class="ow">or</span> <span class="n">internal_style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span><span class="p">:</span>
       <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line styles must be one of: </span><span class="si">{</span><span class="n">valid_line_styles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

   <span class="c1"># Setup</span>
   <span class="n">set_publication_style</span><span class="p">()</span>

   <span class="c1"># Extract boundary and internal edges</span>
   <span class="n">extractor</span> <span class="o">=</span> <span class="n">VoronoiEdgeExtractor</span><span class="p">(</span><span class="n">use_kdtree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="n">boundary_edges</span><span class="p">,</span> <span class="n">internal_cell_edges</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">extract_edges</span><span class="p">(</span><span class="n">modified_cells</span><span class="o">=</span><span class="n">voronoi_cells</span><span class="p">,</span>
                                                                  <span class="n">original_cells</span><span class="o">=</span><span class="n">original_cells</span><span class="p">)</span>

   <span class="c1"># Prepare file names</span>
   <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">base_figure</span><span class="p">)</span>
   <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>
   <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

   <span class="c1"># Plot whole region</span>
   <span class="n">plot_boundary_with_points</span><span class="p">(</span>
       <span class="n">polygon</span><span class="o">=</span><span class="n">MultiPolygon</span><span class="p">(</span><span class="n">voronoi_cells</span><span class="p">),</span>
       <span class="n">figure_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_whole</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
       <span class="n">show_figure</span><span class="o">=</span><span class="n">show_figure</span>
   <span class="p">)</span>

   <span class="c1"># Plot boundary edges</span>
   <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
   
   <span class="c1"># Set margins</span>
   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
   
   <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
       
   <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">boundary_edges</span><span class="p">:</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">edge</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span>
               <span class="n">color</span><span class="o">=</span><span class="n">boundary_color</span><span class="p">,</span>
               <span class="n">linestyle</span><span class="o">=</span><span class="n">boundary_style</span><span class="p">,</span>
               <span class="n">linewidth</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>
   
   <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
       <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_boundary</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
       <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
       <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
       <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span>
   <span class="p">)</span>
   <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
       <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

   <span class="c1"># Plot internal edges</span>
   <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
   
   <span class="c1"># Set margins</span>
   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
   
   <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
       
   <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">internal_cell_edges</span><span class="p">:</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">edge</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span>
               <span class="n">color</span><span class="o">=</span><span class="n">internal_color</span><span class="p">,</span>
               <span class="n">linestyle</span><span class="o">=</span><span class="n">internal_style</span><span class="p">,</span>
               <span class="n">linewidth</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>
   
   <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
       <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_internal</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
       <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
       <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
       <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span>
   <span class="p">)</span>
   <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
       <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1"># Plot the the Voronoi cells highlighting the short edges</span>
<div class="viewcode-block" id="plot_voronoi_cells_with_short_edges">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.plot_voronoi_cells_with_short_edges">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_voronoi_cells_with_short_edges</span><span class="p">(</span>
    <span class="n">voronoi_cells</span><span class="p">,</span>
    <span class="n">figure_name</span><span class="p">,</span>
    <span class="n">N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cell_color</span><span class="o">=</span><span class="s1">&#39;#1B365D&#39;</span><span class="p">,</span>
    <span class="n">cell_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">cell_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">short_edge_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">short_edge_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">short_edge_width</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">point_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">point_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">point_marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="n">margins</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
    <span class="n">show_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot Voronoi cells with highlighted short edges based on either N shortest edges</span>
<span class="sd">    or a threshold length.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    voronoi_cells : list</span>
<span class="sd">        List of shapely.geometry.Polygon or shapely.geometry.MultiPolygon objects</span>
<span class="sd">        representing the Voronoi cells.</span>
<span class="sd">    figure_name : str</span>
<span class="sd">        Name of the output figure. If no extension provided, &#39;.png&#39; is used.</span>
<span class="sd">    N : int, optional</span>
<span class="sd">        Number of shortest edges to highlight. Must specify either N or threshold,</span>
<span class="sd">        but not both.</span>
<span class="sd">    threshold : float, optional</span>
<span class="sd">        Length threshold below which edges are highlighted. Must specify either N</span>
<span class="sd">        or threshold, but not both.</span>
<span class="sd">    points : numpy.ndarray, optional</span>
<span class="sd">        Array of points with shape (n, 2) containing x, y coordinates.</span>
<span class="sd">    show_figure : bool, optional</span>
<span class="sd">        Whether to display the figure, by default True.</span>
<span class="sd">    cell_color : str, optional</span>
<span class="sd">        Color for Voronoi cell boundaries. Can use shorthand or full name.</span>
<span class="sd">        Common shorthands: &#39;k&#39; (black), &#39;r&#39; (red), &#39;b&#39; (blue), &#39;g&#39; (green).</span>
<span class="sd">        Default is &#39;k&#39;.</span>
<span class="sd">    cell_style : str, optional</span>
<span class="sd">        Line style for cell boundaries. Options: [&#39;-&#39;, &#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">        Default is &#39;-&#39; (solid).</span>
<span class="sd">    cell_width : float, optional</span>
<span class="sd">        Width of cell boundary lines, by default 0.5.</span>
<span class="sd">    short_edge_color : str, optional</span>
<span class="sd">        Color for highlighted short edges. Same color options as cell_color.</span>
<span class="sd">        Default is &#39;r&#39;.</span>
<span class="sd">    short_edge_style : str, optional</span>
<span class="sd">        Line style for short edges. Same options as cell_style.</span>
<span class="sd">        Default is &#39;-&#39; (solid).</span>
<span class="sd">    short_edge_width : float, optional</span>
<span class="sd">        Width of short edge lines, by default 2.0.</span>
<span class="sd">    point_color : str, optional</span>
<span class="sd">        Color for points. Same color options as cell_color.</span>
<span class="sd">        Default is &#39;r&#39;.</span>
<span class="sd">    point_size : float, optional</span>
<span class="sd">        Size of points, by default 0.5.</span>
<span class="sd">    point_alpha : float, optional</span>
<span class="sd">        Transparency of points (0 to 1), by default 1.0.</span>
<span class="sd">    point_marker : str, optional</span>
<span class="sd">        Marker style for points. Common options: &#39;o&#39; (circle), &#39;s&#39; (square),</span>
<span class="sd">        &#39;^&#39; (triangle up), &#39;v&#39; (triangle down), &#39;*&#39; (star).</span>
<span class="sd">        Default is &#39;o&#39;.</span>
<span class="sd">    margins : float or tuple, optional</span>
<span class="sd">        Margins around the plot. Can be:</span>
<span class="sd">        - Single float for same margins in x and y</span>
<span class="sd">        - Tuple (x_margin, y_margin) for different margins</span>
<span class="sd">        Default is 0.01 (1% margin in both x and y).</span>
<span class="sd">    dpi : int, optional</span>
<span class="sd">        Resolution of saved figure in dots per inch, by default 1200.</span>
<span class="sd">    show_axes : bool, optional</span>
<span class="sd">        Whether to show axes and ticks, by default False.</span>
<span class="sd">    output_dir : str, optional</span>
<span class="sd">        Directory to save the figure, by default &#39;Plots&#39;.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If neither or both N and threshold are specified.</span>
<span class="sd">        If N is negative.</span>
<span class="sd">        If threshold is negative.</span>
<span class="sd">        If points array has incorrect shape.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function automatically creates the output directory if it doesn&#39;t exist.</span>
<span class="sd">    Uses the publication style settings from set_publication_style().</span>

<span class="sd">    Color specifications can use either shorthand (e.g., &#39;k&#39;, &#39;r&#39;, &#39;b&#39;) or </span>
<span class="sd">    full names (e.g., &#39;black&#39;, &#39;red&#39;, &#39;blue&#39;).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Highlight 5 shortest edges</span>
<span class="sd">    &gt;&gt;&gt; plot_voronoi_cells_with_short_edges(</span>
<span class="sd">    ...     voronoi_cells,</span>
<span class="sd">    ...     &#39;short_edges&#39;,</span>
<span class="sd">    ...     N=5,</span>
<span class="sd">    ...     short_edge_color=&#39;red&#39;,</span>
<span class="sd">    ...     short_edge_width=3.0</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    &gt;&gt;&gt; # Highlight edges shorter than 0.1 units</span>
<span class="sd">    &gt;&gt;&gt; plot_voronoi_cells_with_short_edges(</span>
<span class="sd">    ...     voronoi_cells,</span>
<span class="sd">    ...     &#39;short_edges&#39;,</span>
<span class="sd">    ...     threshold=0.1,</span>
<span class="sd">    ...     cell_color=&#39;navy&#39;,</span>
<span class="sd">    ...     short_edge_color=&#39;darkred&#39;</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Specify exactly one of &#39;N&#39; or &#39;threshold&#39;&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;N must be non-negative&quot;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">threshold</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;threshold must be non-negative&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;points must be a numpy array with shape (n, 2)&quot;</span><span class="p">)</span>

    <span class="n">valid_line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cell_style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span> <span class="ow">or</span> <span class="n">short_edge_style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line styles must be one of: </span><span class="si">{</span><span class="n">valid_line_styles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Setup</span>
    <span class="n">set_publication_style</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># Set margins</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1"># Collect and sort edges</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">voronoi_cells</span><span class="p">:</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">)</span> <span class="k">else</span> <span class="n">cell</span><span class="o">.</span><span class="n">geoms</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">edge</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">edge</span><span class="p">))</span>
    
    <span class="n">edges</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1"># Select short edges</span>
    <span class="n">short_edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span> <span class="k">if</span> <span class="n">N</span> <span class="k">else</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span>
    
    <span class="c1"># Plot Voronoi cells</span>
    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">voronoi_cells</span><span class="p">:</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">)</span> <span class="k">else</span> <span class="n">cell</span><span class="o">.</span><span class="n">geoms</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="n">cell_color</span><span class="p">,</span>
                   <span class="n">linestyle</span><span class="o">=</span><span class="n">cell_style</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="n">cell_width</span><span class="p">)</span>
    
    <span class="c1"># Highlight short edges</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">short_edges</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">short_edge_color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">short_edge_style</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">short_edge_width</span><span class="p">)</span>
    
    <span class="c1"># Plot points if provided</span>
    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span>
            <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="n">point_marker</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">point_alpha</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
    
    <span class="c1"># Handle axes visibility</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1"># Handle figure saving</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">figure_name</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
        <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1"># Plot the triangulated Geometries and Voronoi cells</span>
<div class="viewcode-block" id="plot_triangulated_geometry">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.plot_triangulated_geometry">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_triangulated_geometry</span><span class="p">(</span>
    <span class="n">geometry</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]],</span>
    <span class="n">triangulation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Polygon</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]]],</span>
    <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">highlight_short_edges</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_figure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">cell_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;#1B365D&#39;</span><span class="p">,</span>
    <span class="n">cell_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">cell_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="n">triangle_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">triangle_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">triangle_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">short_edge_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">short_edge_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">short_edge_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="n">margins</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
    <span class="n">show_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot triangulated geometry - handles both single polygon and multiple Voronoi cells.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    geometry : Union[Polygon, List[Polygon]]</span>
<span class="sd">        Either a single shapely.geometry.Polygon or a list of Polygons (Voronoi cells)</span>
<span class="sd">    triangulation : Union[List[Polygon], Dict[int, List[Polygon]]]</span>
<span class="sd">        Either a list of triangles (for single polygon) or a dictionary mapping </span>
<span class="sd">        cell indices to lists of triangles (for Voronoi cells)</span>
<span class="sd">    ... (rest of parameters same as original)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function now handles two cases:</span>
<span class="sd">    1. Single polygon with holes and its triangulation</span>
<span class="sd">    2. Multiple Voronoi cells and their triangulations (original functionality)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="k">if</span> <span class="n">highlight_short_edges</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;When highlight_short_edges is True, &quot;</span>
                <span class="s2">&quot;specify exactly one of &#39;N&#39; or &#39;threshold&#39;&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;N must be non-negative&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">threshold</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;threshold must be non-negative&quot;</span><span class="p">)</span>

    <span class="n">valid_line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cell_style</span><span class="p">,</span> <span class="n">triangle_style</span><span class="p">,</span> <span class="n">short_edge_style</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line styles must be one of: </span><span class="si">{</span><span class="n">valid_line_styles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Normalize inputs to handle both cases</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
        <span class="n">geometries</span> <span class="o">=</span> <span class="p">[</span><span class="n">geometry</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">triangulation</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For single polygon input, triangulation must be a list of triangles&quot;</span><span class="p">)</span>
        <span class="n">triangulations</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">triangulation</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">geometries</span> <span class="o">=</span> <span class="n">geometry</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">triangulation</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For multiple polygons input, triangulation must be a dictionary&quot;</span><span class="p">)</span>
        <span class="n">triangulations</span> <span class="o">=</span> <span class="n">triangulation</span>

    <span class="c1"># Setup</span>
    <span class="n">set_publication_style</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    
    <span class="c1"># Set margins</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1"># Process short edges if needed</span>
    <span class="n">short_edge_coords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">highlight_short_edges</span><span class="p">:</span>
        <span class="c1"># Collect and measure all boundary edges</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">:</span>
            <span class="c1"># Handle exterior boundaries</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">edge</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">edge</span><span class="p">))</span>
            
            <span class="c1"># Handle interior boundaries (holes)</span>
            <span class="n">has_interiors</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">interiors</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">has_interiors</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">interior</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">interior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">edge</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
                        <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">edge</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">edge</span><span class="p">))</span>
        
        <span class="c1"># Determine short edges based on criteria</span>
        <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">short_edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">short_edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span>
        
        <span class="c1"># Create set of short edge coordinates for efficient lookup</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">short_edges</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">coords</span><span class="p">))</span>
            <span class="n">short_edge_coords</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">short_edge_coords</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1"># Plot geometry boundaries</span>
    <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">:</span>
        <span class="c1"># Plot exterior boundary</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">edge_coords</span> <span class="o">=</span> <span class="p">((</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            
            <span class="k">if</span> <span class="n">highlight_short_edges</span> <span class="ow">and</span> <span class="p">(</span><span class="n">edge_coords</span> <span class="ow">in</span> <span class="n">short_edge_coords</span> <span class="ow">or</span> 
                                        <span class="n">edge_coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">short_edge_coords</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> 
                       <span class="n">color</span><span class="o">=</span><span class="n">short_edge_color</span><span class="p">,</span>
                       <span class="n">linestyle</span><span class="o">=</span><span class="n">short_edge_style</span><span class="p">,</span>
                       <span class="n">linewidth</span><span class="o">=</span><span class="n">short_edge_width</span><span class="p">,</span>
                       <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> 
                       <span class="n">color</span><span class="o">=</span><span class="n">cell_color</span><span class="p">,</span>
                       <span class="n">linestyle</span><span class="o">=</span><span class="n">cell_style</span><span class="p">,</span>
                       <span class="n">linewidth</span><span class="o">=</span><span class="n">cell_width</span><span class="p">,</span>
                       <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Plot interior boundaries (holes)</span>
        <span class="n">has_interiors</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">interiors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">has_interiors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">interior</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">interior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">edge_coords</span> <span class="o">=</span> <span class="p">((</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    
                    <span class="k">if</span> <span class="n">highlight_short_edges</span> <span class="ow">and</span> <span class="p">(</span><span class="n">edge_coords</span> <span class="ow">in</span> <span class="n">short_edge_coords</span> <span class="ow">or</span> 
                                                <span class="n">edge_coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">short_edge_coords</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> 
                            <span class="n">color</span><span class="o">=</span><span class="n">short_edge_color</span><span class="p">,</span>
                            <span class="n">linestyle</span><span class="o">=</span><span class="n">short_edge_style</span><span class="p">,</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="n">short_edge_width</span><span class="p">,</span>
                            <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> 
                            <span class="n">color</span><span class="o">=</span><span class="n">cell_color</span><span class="p">,</span>
                            <span class="n">linestyle</span><span class="o">=</span><span class="n">cell_style</span><span class="p">,</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="n">cell_width</span><span class="p">,</span>
                            <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Plot triangulations</span>
    <span class="k">for</span> <span class="n">cell_idx</span><span class="p">,</span> <span class="n">triangles</span> <span class="ow">in</span> <span class="n">triangulations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">triangle</span> <span class="ow">in</span> <span class="n">triangles</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">triangle</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="n">triangle_color</span><span class="p">,</span>
                   <span class="n">linestyle</span><span class="o">=</span><span class="n">triangle_style</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="n">triangle_width</span><span class="p">,</span>
                   <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Handle axes visibility</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1"># Handle figure saving</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">figure_name</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
        <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1"># Plotting the error vs iteration comparison with and without decay mechanism</span>
<div class="viewcode-block" id="plot_error_comparison">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.plot_error_comparison">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_error_comparison</span><span class="p">(</span>
    <span class="n">metrics1</span><span class="p">,</span>
    <span class="n">metrics2</span><span class="p">,</span>
    <span class="n">figure_name</span><span class="p">,</span>
    <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">line1_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">line1_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">line1_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">line2_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">line2_style</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">line2_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">marker_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">grid_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">ref_line_color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
    <span class="n">ref_line_style</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="n">ref_line_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">label1</span><span class="o">=</span><span class="s1">&#39;Without Decay&#39;</span><span class="p">,</span>
    <span class="n">label2</span><span class="o">=</span><span class="s1">&#39;With Decay&#39;</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot error comparison between two optimization methods.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    metrics1 : dict</span>
<span class="sd">        Dictionary containing error metrics for first method with keys:</span>
<span class="sd">        - &#39;error_values&#39;: list of error values per iteration</span>
<span class="sd">        - &#39;min_error&#39;: minimum error achieved</span>
<span class="sd">    metrics2 : dict</span>
<span class="sd">        Dictionary containing error metrics for second method with same structure</span>
<span class="sd">        as metrics1.</span>
<span class="sd">    figure_name : str</span>
<span class="sd">        Name of the output figure. If no extension provided, &#39;.png&#39; is used.</span>
<span class="sd">    show_figure : bool, optional</span>
<span class="sd">        Whether to display the figure, by default True.</span>
<span class="sd">    line1_color : str, optional</span>
<span class="sd">        Color for first method&#39;s line. Can use shorthand or full name.</span>
<span class="sd">        Common shorthands: &#39;k&#39; (black), &#39;r&#39; (red), &#39;b&#39; (blue), &#39;g&#39; (green).</span>
<span class="sd">        Default is &#39;k&#39;.</span>
<span class="sd">    line1_style : str, optional</span>
<span class="sd">        Line style for first method. Options: [&#39;-&#39;, &#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">        Default is &#39;-&#39; (solid).</span>
<span class="sd">    line1_width : float, optional</span>
<span class="sd">        Width of first method&#39;s line, by default 1.0.</span>
<span class="sd">    line2_color : str, optional</span>
<span class="sd">        Color for second method&#39;s line. Same options as line1_color.</span>
<span class="sd">        Default is &#39;r&#39;.</span>
<span class="sd">    line2_style : str, optional</span>
<span class="sd">        Line style for second method. Same options as line1_style.</span>
<span class="sd">        Default is &#39;--&#39; (dashed).</span>
<span class="sd">    line2_width : float, optional</span>
<span class="sd">        Width of second method&#39;s line, by default 1.0.</span>
<span class="sd">    marker_size : float, optional</span>
<span class="sd">        Size of markers at target error points, by default 4.</span>
<span class="sd">    grid_alpha : float, optional</span>
<span class="sd">        Transparency of grid lines (0 to 1), by default 0.2.</span>
<span class="sd">    ref_line_color : str, optional</span>
<span class="sd">        Color for reference line at target error. Same options as line1_color.</span>
<span class="sd">        Default is &#39;gray&#39;.</span>
<span class="sd">    ref_line_style : str, optional</span>
<span class="sd">        Line style for reference line. Same options as line1_style.</span>
<span class="sd">        Default is &#39;:&#39; (dotted).</span>
<span class="sd">    ref_line_alpha : float, optional</span>
<span class="sd">        Transparency of reference line (0 to 1), by default 0.5.</span>
<span class="sd">    label1 : str, optional</span>
<span class="sd">        Label for first method in legend, by default &#39;Without Decay&#39;.</span>
<span class="sd">    label2 : str, optional</span>
<span class="sd">        Label for second method in legend, by default &#39;With Decay&#39;.</span>
<span class="sd">    dpi : int, optional</span>
<span class="sd">        Resolution of saved figure in dots per inch, by default 1200.</span>
<span class="sd">    output_dir : str, optional</span>
<span class="sd">        Directory to save the figure, by default &#39;Plots&#39;.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function automatically creates the output directory if it doesn&#39;t exist.</span>
<span class="sd">    Uses the publication style settings from set_publication_style().</span>
<span class="sd">    Plot shows error on logarithmic scale vs. iteration number.</span>
<span class="sd">    Markers indicate where each method reaches the target error.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; metrics_no_decay = {</span>
<span class="sd">    ...     &#39;error_values&#39;: [1.0, 0.5, 0.1, 0.01],</span>
<span class="sd">    ...     &#39;min_error&#39;: 0.01</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; metrics_with_decay = {</span>
<span class="sd">    ...     &#39;error_values&#39;: [1.0, 0.3, 0.05, 0.005],</span>
<span class="sd">    ...     &#39;min_error&#39;: 0.005</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; plot_error_comparison(</span>
<span class="sd">    ...     metrics_no_decay,</span>
<span class="sd">    ...     metrics_with_decay,</span>
<span class="sd">    ...     &#39;error_comparison&#39;,</span>
<span class="sd">    ...     line1_color=&#39;navy&#39;,</span>
<span class="sd">    ...     line2_color=&#39;darkred&#39;</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="n">valid_line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="n">line1_style</span><span class="p">,</span> <span class="n">line2_style</span><span class="p">,</span> <span class="n">ref_line_style</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line styles must be one of: </span><span class="si">{</span><span class="n">valid_line_styles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="p">[</span><span class="n">grid_alpha</span><span class="p">,</span> <span class="n">ref_line_alpha</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Alpha values must be between 0 and 1&quot;</span><span class="p">)</span>
    
    <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;error_values&#39;</span><span class="p">,</span> <span class="s1">&#39;min_error&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">metrics1</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;metrics1 missing required keys&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">metrics2</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;metrics2 missing required keys&quot;</span><span class="p">)</span>

    <span class="c1"># Setup</span>
    <span class="n">set_publication_style</span><span class="p">()</span>
    
    <span class="c1"># Find target error and iterations to reach it</span>
    <span class="n">target_error</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;min_error&#39;</span><span class="p">],</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;min_error&#39;</span><span class="p">])</span>
    <span class="n">iter1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">error</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;error_values&#39;</span><span class="p">])</span> 
                <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;=</span> <span class="n">target_error</span><span class="p">)</span>
    <span class="n">iter2</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">error</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;error_values&#39;</span><span class="p">])</span> 
                <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;=</span> <span class="n">target_error</span><span class="p">)</span>
    
    <span class="c1"># Setup plot range</span>
    <span class="n">max_iter</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">iter1</span><span class="p">,</span> <span class="n">iter2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">iterations</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">)</span>
    
    <span class="c1"># Create plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
    
    <span class="c1"># Plot error curves</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;error_values&#39;</span><span class="p">][:</span><span class="n">max_iter</span><span class="p">],</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">line1_color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">line1_style</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">line1_width</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label1</span><span class="si">}</span><span class="s1"> (target error at iter </span><span class="si">{</span><span class="n">iter1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;error_values&#39;</span><span class="p">][:</span><span class="n">max_iter</span><span class="p">],</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">line2_color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">line2_style</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">line2_width</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label2</span><span class="si">}</span><span class="s1"> (target error at iter </span><span class="si">{</span><span class="n">iter2</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    
    <span class="c1"># Add target markers</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iter1</span><span class="p">,</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;error_values&#39;</span><span class="p">][</span><span class="n">iter1</span><span class="p">],</span> 
            <span class="n">color</span><span class="o">=</span><span class="n">line1_color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">marker_size</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iter2</span><span class="p">,</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;error_values&#39;</span><span class="p">][</span><span class="n">iter2</span><span class="p">],</span> 
            <span class="n">color</span><span class="o">=</span><span class="n">line2_color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">marker_size</span><span class="p">)</span>
    
    <span class="c1"># Add reference line</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">target_error</span><span class="p">,</span> 
               <span class="n">color</span><span class="o">=</span><span class="n">ref_line_color</span><span class="p">,</span>
               <span class="n">linestyle</span><span class="o">=</span><span class="n">ref_line_style</span><span class="p">,</span>
               <span class="n">alpha</span><span class="o">=</span><span class="n">ref_line_alpha</span><span class="p">)</span>
    
    <span class="c1"># Customize plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">grid_alpha</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1"># Handle figure saving</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">figure_name</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
        <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<span class="c1"># Fuction to plot the Polygon boundaries highlighting the short edges</span>
<div class="viewcode-block" id="plot_boundary_with_short_edges">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.plot_boundary_with_short_edges">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_boundary_with_short_edges</span><span class="p">(</span>
    <span class="n">polygon</span><span class="p">,</span>
    <span class="n">figure_name</span><span class="p">,</span>
    <span class="n">N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">boundary_color</span><span class="o">=</span><span class="s1">&#39;#1B365D&#39;</span><span class="p">,</span>
    <span class="n">boundary_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">boundary_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">interior_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">interior_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">interior_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">short_edge_color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span>
    <span class="n">short_edge_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">short_edge_width</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">short_edge_alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">margins</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
    <span class="n">show_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot polygon boundaries with highlighted short edges based on either N shortest</span>
<span class="sd">    edges or a threshold length.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    polygon : shapely.geometry.Polygon or shapely.geometry.MultiPolygon</span>
<span class="sd">        The polygon(s) whose boundary is to be plotted.</span>
<span class="sd">    figure_name : str</span>
<span class="sd">        Name of the output figure. If no extension provided, &#39;.png&#39; is used.</span>
<span class="sd">    N : int, optional</span>
<span class="sd">        Number of shortest edges to highlight. Must specify either N or threshold,</span>
<span class="sd">        but not both.</span>
<span class="sd">    threshold : float, optional</span>
<span class="sd">        Length threshold below which edges are highlighted. Must specify either N</span>
<span class="sd">        or threshold, but not both.</span>
<span class="sd">    show_figure : bool, optional</span>
<span class="sd">        Whether to display the figure, by default True.</span>
<span class="sd">    boundary_color : str, optional</span>
<span class="sd">        Color for exterior boundaries. Can use shorthand or full name.</span>
<span class="sd">        Common shorthands: &#39;k&#39; (black), &#39;r&#39; (red), &#39;b&#39; (blue), &#39;g&#39; (green).</span>
<span class="sd">        Default is &#39;k&#39;.</span>
<span class="sd">    boundary_style : str, optional</span>
<span class="sd">        Line style for exterior boundaries. Options: [&#39;-&#39;, &#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">        Default is &#39;-&#39; (solid).</span>
<span class="sd">    boundary_width : float, optional</span>
<span class="sd">        Width of exterior boundary lines, by default 0.5.</span>
<span class="sd">    interior_color : str, optional</span>
<span class="sd">        Color for interior boundaries. Same color options as boundary_color.</span>
<span class="sd">        Default is &#39;r&#39;.</span>
<span class="sd">    interior_style : str, optional</span>
<span class="sd">        Line style for interior boundaries. Same options as boundary_style.</span>
<span class="sd">        Default is &#39;-&#39; (solid).</span>
<span class="sd">    interior_width : float, optional</span>
<span class="sd">        Width of interior boundary lines, by default 0.5.</span>
<span class="sd">    short_edge_color : str, optional</span>
<span class="sd">        Color for highlighted short edges. Same color options as boundary_color.</span>
<span class="sd">        Default is &#39;orange&#39;.</span>
<span class="sd">    short_edge_style : str, optional</span>
<span class="sd">        Line style for short edges. Same options as boundary_style.</span>
<span class="sd">        Default is &#39;-&#39; (solid).</span>
<span class="sd">    short_edge_width : float, optional</span>
<span class="sd">        Width of short edge lines, by default 2.0.</span>
<span class="sd">    short_edge_alpha : float, optional</span>
<span class="sd">        Transparency of short edges (0 to 1), by default 0.8.</span>
<span class="sd">    margins : float or tuple, optional</span>
<span class="sd">        Margins around the plot. Can be:</span>
<span class="sd">        - Single float for same margins in x and y</span>
<span class="sd">        - Tuple (x_margin, y_margin) for different margins</span>
<span class="sd">        Default is 0.01 (1% margin in both x and y).</span>
<span class="sd">    dpi : int, optional</span>
<span class="sd">        Resolution of saved figure in dots per inch, by default 1200.</span>
<span class="sd">    show_axes : bool, optional</span>
<span class="sd">        Whether to show axes and ticks, by default False.</span>
<span class="sd">    output_dir : str, optional</span>
<span class="sd">        Directory to save the figure, by default &#39;Plots&#39;.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If neither or both N and threshold are specified.</span>
<span class="sd">        If N is negative.</span>
<span class="sd">        If threshold is negative.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function automatically creates the output directory if it doesn&#39;t exist.</span>
<span class="sd">    Uses the publication style settings from set_publication_style().</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Highlight 5 shortest edges</span>
<span class="sd">    &gt;&gt;&gt; plot_boundary_with_short_edges(</span>
<span class="sd">    ...     polygon,</span>
<span class="sd">    ...     &#39;boundary_short&#39;,</span>
<span class="sd">    ...     N=5,</span>
<span class="sd">    ...     short_edge_color=&#39;red&#39;,</span>
<span class="sd">    ...     short_edge_width=3.0</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    &gt;&gt;&gt; # Highlight edges shorter than 0.1 units</span>
<span class="sd">    &gt;&gt;&gt; plot_boundary_with_short_edges(</span>
<span class="sd">    ...     polygon,</span>
<span class="sd">    ...     &#39;boundary_short&#39;,</span>
<span class="sd">    ...     threshold=0.1,</span>
<span class="sd">    ...     boundary_color=&#39;navy&#39;,</span>
<span class="sd">    ...     short_edge_color=&#39;orange&#39;</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Specify exactly one of &#39;N&#39; or &#39;threshold&#39;&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;N must be non-negative&quot;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">threshold</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;threshold must be non-negative&quot;</span><span class="p">)</span>

    <span class="n">valid_line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="n">boundary_style</span><span class="p">,</span> <span class="n">interior_style</span><span class="p">,</span> <span class="n">short_edge_style</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line styles must be one of: </span><span class="si">{</span><span class="n">valid_line_styles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">short_edge_alpha</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Alpha value must be between 0 and 1&quot;</span><span class="p">)</span>

    <span class="c1"># Setup</span>
    <span class="n">set_publication_style</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="c1"># Set margins</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Function to collect edges from a polygon</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">collect_edges_from_polygon</span><span class="p">(</span><span class="n">polygon</span><span class="p">):</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Exterior edges</span>
        <span class="n">exterior_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exterior_coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([</span><span class="n">exterior_coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">exterior_coords</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
        <span class="c1"># Interior edges</span>
        <span class="k">for</span> <span class="n">interior</span> <span class="ow">in</span> <span class="n">polygon</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
            <span class="n">interior_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">interior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interior_coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([</span><span class="n">interior_coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">interior_coords</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">edges</span>

    <span class="c1"># Collect all edges</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
        <span class="n">edges</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">collect_edges_from_polygon</span><span class="p">(</span><span class="n">polygon</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># MultiPolygon</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">polygon</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">collect_edges_from_polygon</span><span class="p">(</span><span class="n">poly</span><span class="p">))</span>

    <span class="c1"># Determine short edges</span>
    <span class="n">edges</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">short_edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">[:</span><span class="n">N</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">short_edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge</span> <span class="k">for</span> <span class="n">length</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span>

    <span class="c1"># Plot polygon boundaries</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">polygon</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">)</span> <span class="k">else</span> <span class="n">polygon</span><span class="o">.</span><span class="n">geoms</span>
    <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">:</span>
        <span class="c1"># Plot exterior</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">boundary_color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">boundary_style</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">boundary_width</span><span class="p">)</span>
        
        <span class="c1"># Plot interiors</span>
        <span class="k">for</span> <span class="n">interior</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">interior</span><span class="o">.</span><span class="n">xy</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="n">interior_color</span><span class="p">,</span>
                   <span class="n">linestyle</span><span class="o">=</span><span class="n">interior_style</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="n">interior_width</span><span class="p">)</span>

    <span class="c1"># Plot short edges</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">short_edges</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">short_edge_color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">short_edge_style</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">short_edge_width</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">short_edge_alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Handle axes visibility</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Handle figure saving</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">figure_name</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
        <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<span class="c1"># Function to plot the density of plate with hole</span>
<div class="viewcode-block" id="plot_density_plate_with_hole">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.plot_density_plate_with_hole">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_density_plate_with_hole</span><span class="p">(</span>
   <span class="n">rect_point1</span><span class="p">,</span>
   <span class="n">rect_point2</span><span class="p">,</span>
   <span class="n">circle_center</span><span class="p">,</span>
   <span class="n">circle_radius</span><span class="p">,</span>
   <span class="n">figure_name</span><span class="p">,</span>
   <span class="n">max_density</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
   <span class="n">min_density</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
   <span class="n">decay_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
   <span class="n">resolution</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
   <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
   <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
   <span class="n">rect_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
   <span class="n">rect_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
   <span class="n">rect_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
   <span class="n">circle_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
   <span class="n">circle_style</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
   <span class="n">circle_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
   <span class="n">view_elevation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
   <span class="n">view_azimuth</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>
   <span class="n">margins</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
   <span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
   <span class="n">show_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
   <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;Create 2D heatmap and 3D surface plot of density function for a plate with hole.</span>

<span class="sd">   Parameters</span>
<span class="sd">   ----------</span>
<span class="sd">   rect_point1 : tuple</span>
<span class="sd">       Lower-left corner coordinates (x, y) of the rectangular plate.</span>
<span class="sd">   rect_point2 : tuple</span>
<span class="sd">       Upper-right corner coordinates (x, y) of the rectangular plate.</span>
<span class="sd">   circle_center : tuple</span>
<span class="sd">       Center coordinates (x, y) of the circular hole.</span>
<span class="sd">   circle_radius : float</span>
<span class="sd">       Radius of the circular hole.</span>
<span class="sd">   figure_name : str</span>
<span class="sd">       Base name for the output figures. If no extension provided, &#39;.png&#39; is used.</span>
<span class="sd">       Two files will be created with suffixes: &#39;_2DHeatmap&#39; and &#39;_3DSurface&#39;.</span>
<span class="sd">   max_density : float, optional</span>
<span class="sd">       Maximum density value at circle boundary, by default 1.0.</span>
<span class="sd">   min_density : float, optional</span>
<span class="sd">       Minimum density value far from circle, by default 0.1.</span>
<span class="sd">   decay_rate : float, optional</span>
<span class="sd">       Rate of density decay with distance from circle, by default 0.5.</span>
<span class="sd">   resolution : int, optional</span>
<span class="sd">       Grid resolution for visualization, by default 200.</span>
<span class="sd">   show_figure : bool, optional</span>
<span class="sd">       Whether to display the figures, by default True.</span>
<span class="sd">   colormap : str, optional</span>
<span class="sd">       Matplotlib colormap name, by default &#39;viridis&#39;.</span>
<span class="sd">   rect_color : str, optional</span>
<span class="sd">       Color for rectangle boundary. Can use shorthand or full name.</span>
<span class="sd">       Default is &#39;k&#39;.</span>
<span class="sd">   rect_style : str, optional</span>
<span class="sd">       Line style for rectangle. Options: [&#39;-&#39;, &#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">       Default is &#39;-&#39; (solid).</span>
<span class="sd">   rect_width : float, optional</span>
<span class="sd">       Width of rectangle boundary line, by default 0.5.</span>
<span class="sd">   circle_color : str, optional</span>
<span class="sd">       Color for circle boundary. Same options as rect_color.</span>
<span class="sd">       Default is &#39;r&#39;.</span>
<span class="sd">   circle_style : str, optional</span>
<span class="sd">       Line style for circle. Same options as rect_style.</span>
<span class="sd">       Default is &#39;--&#39; (dashed).</span>
<span class="sd">   circle_width : float, optional</span>
<span class="sd">       Width of circle boundary line, by default 0.5.</span>
<span class="sd">   view_elevation : float, optional</span>
<span class="sd">       Elevation angle for 3D view, by default 30.</span>
<span class="sd">   view_azimuth : float, optional</span>
<span class="sd">       Azimuth angle for 3D view, by default 45.</span>
<span class="sd">   margins : float or tuple, optional</span>
<span class="sd">       Margins around the plot. Can be:</span>
<span class="sd">       - Single float for same margins in x and y</span>
<span class="sd">       - Tuple (x_margin, y_margin) for different margins</span>
<span class="sd">       Default is 0.01 (1% margin).</span>
<span class="sd">   dpi : int, optional</span>
<span class="sd">       Resolution of saved figures in dots per inch, by default 1200.</span>
<span class="sd">   show_axes : bool, optional</span>
<span class="sd">       Whether to show axes and ticks, by default True.</span>
<span class="sd">   output_dir : str, optional</span>
<span class="sd">       Directory to save the figures, by default &#39;Plots&#39;.</span>

<span class="sd">   Notes</span>
<span class="sd">   -----</span>
<span class="sd">   The function automatically creates the output directory if it doesn&#39;t exist.</span>
<span class="sd">   Uses the publication style settings from set_publication_style().</span>
<span class="sd">   </span>
<span class="sd">   The density function uses an exponential decay from the circle boundary:</span>
<span class="sd">   density = max_density * exp(-decay_rate * distance) + min_density</span>

<span class="sd">   Examples</span>
<span class="sd">   --------</span>
<span class="sd">   &gt;&gt;&gt; # Create density plots for a square plate with centered hole</span>
<span class="sd">   &gt;&gt;&gt; plot_density_plate_with_hole(</span>
<span class="sd">   ...     rect_point1=(-1, -1),</span>
<span class="sd">   ...     rect_point2=(1, 1),</span>
<span class="sd">   ...     circle_center=(0, 0),</span>
<span class="sd">   ...     circle_radius=0.3,</span>
<span class="sd">   ...     figure_name=&#39;density_plot&#39;,</span>
<span class="sd">   ...     decay_rate=1.0</span>
<span class="sd">   ... )</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># Input validation</span>
   <span class="n">valid_line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
   <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="n">rect_style</span><span class="p">,</span> <span class="n">circle_style</span><span class="p">]:</span>
       <span class="k">if</span> <span class="n">style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span><span class="p">:</span>
           <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line styles must be one of: </span><span class="si">{</span><span class="n">valid_line_styles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

   <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">min_density</span> <span class="o">&lt;=</span> <span class="n">max_density</span><span class="p">:</span>
       <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;min_density must be positive and not greater than max_density&quot;</span><span class="p">)</span>
   
   <span class="k">if</span> <span class="n">decay_rate</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
       <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;decay_rate must be positive&quot;</span><span class="p">)</span>
   
   <span class="k">if</span> <span class="n">resolution</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
       <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;resolution must be at least 10&quot;</span><span class="p">)</span>

   <span class="k">def</span><span class="w"> </span><span class="nf">create_density_function</span><span class="p">(</span><span class="n">circle_center</span><span class="p">,</span> <span class="n">circle_radius</span><span class="p">):</span>
<span class="w">       </span><span class="sd">&quot;&quot;&quot;Create density function based on distance from circle boundary.&quot;&quot;&quot;</span>
       <span class="k">def</span><span class="w"> </span><span class="nf">distance_to_circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
           <span class="n">dist_to_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">circle_center</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> 
                                  <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">circle_center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
           <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_to_center</span> <span class="o">-</span> <span class="n">circle_radius</span><span class="p">)</span>
       
       <span class="k">def</span><span class="w"> </span><span class="nf">density_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
           <span class="n">dist</span> <span class="o">=</span> <span class="n">distance_to_circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
           <span class="n">density</span> <span class="o">=</span> <span class="n">max_density</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">decay_rate</span> <span class="o">*</span> <span class="n">dist</span><span class="p">)</span> <span class="o">+</span> <span class="n">min_density</span>
           <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">min_density</span><span class="p">,</span> <span class="n">max_density</span><span class="p">)</span>
       
       <span class="k">return</span> <span class="n">density_function</span>

   <span class="c1"># Setup</span>
   <span class="n">set_publication_style</span><span class="p">()</span>
   <span class="n">density</span> <span class="o">=</span> <span class="n">create_density_function</span><span class="p">(</span><span class="n">circle_center</span><span class="p">,</span> <span class="n">circle_radius</span><span class="p">)</span>

   <span class="c1"># Create grid</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rect_point1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rect_point2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="p">)</span>
   <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rect_point1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rect_point2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolution</span><span class="p">)</span>
   <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
   <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">density</span><span class="p">)(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

   <span class="c1"># Prepare file names</span>
   <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">figure_name</span><span class="p">)</span>
   <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>

   <span class="c1"># Plot 2D Heatmap</span>
   <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> 
                                                 <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>

   <span class="c1"># Set margins for 2D plot</span>
   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

   <span class="n">heatmap</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>
   <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">heatmap</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
   <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
   <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

   <span class="c1"># Add geometry</span>
   <span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">circle_center</span><span class="p">,</span> <span class="n">circle_radius</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="n">circle_color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">circle_style</span><span class="p">,</span>
                      <span class="n">linewidth</span><span class="o">=</span><span class="n">circle_width</span><span class="p">)</span>
   <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">rect_point1</span><span class="p">,</span> 
                       <span class="n">rect_point2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">rect_point1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">rect_point2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rect_point1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                       <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rect_color</span><span class="p">,</span>
                       <span class="n">linestyle</span><span class="o">=</span><span class="n">rect_style</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">rect_width</span><span class="p">)</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

   <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
       <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>

   <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s1">_2DHeatmap</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
       <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

   <span class="c1"># Plot 3D Surface</span>
   <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> 
                                          <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
   <span class="n">ax3d</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

   <span class="c1"># Set margins for 3D plot</span>
   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
       <span class="n">ax3d</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="n">ax3d</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

   <span class="n">surface</span> <span class="o">=</span> <span class="n">ax3d</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
                              <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

   <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3d</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
   <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
   <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

   <span class="n">ax3d</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_elevation</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_azimuth</span><span class="p">)</span>
   
   <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
       <span class="n">ax3d</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="n">ax3d</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
       <span class="n">ax3d</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
       <span class="n">ax3d</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>

   <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s1">_3DSurface</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
       <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
   <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<span class="c1"># Function to plot hexagon density</span>
<div class="viewcode-block" id="plot_density_hexagon">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.plot_density_hexagon">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_density_hexagon</span><span class="p">(</span>
    <span class="n">hexagon_geometry</span><span class="p">,</span>
    <span class="n">density_function</span><span class="p">,</span>
    <span class="n">figure_name</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">margins</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
    <span class="n">hex_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">hex_style</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">hex_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">view_elevation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">view_azimuth</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
    <span class="n">show_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create 2D heatmap and 3D surface plot of density function over a hexagonal region.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hexagon_geometry : dict</span>
<span class="sd">        Dictionary containing the hexagonal geometry with key:</span>
<span class="sd">        - &#39;polygon&#39;: shapely.geometry.Polygon object representing the hexagon</span>
<span class="sd">    density_function : callable</span>
<span class="sd">        Function that takes (x, y) arrays and returns density values.</span>
<span class="sd">        Must be vectorized to handle numpy arrays.</span>
<span class="sd">    figure_name : str</span>
<span class="sd">        Base name for the output figures. If no extension provided, &#39;.png&#39; is used.</span>
<span class="sd">        Two files will be created with suffixes: &#39;_2DHeatmap&#39; and &#39;_3DSurface&#39;.</span>
<span class="sd">    resolution : int, optional</span>
<span class="sd">        Grid resolution for visualization, by default 200.</span>
<span class="sd">    show_figure : bool, optional</span>
<span class="sd">        Whether to display the figures, by default True.</span>
<span class="sd">    margins : float or tuple, optional</span>
<span class="sd">        Margins around the plot. Can be:</span>
<span class="sd">        - Single float for same margins in x and y</span>
<span class="sd">        - Tuple (x_margin, y_margin) for different margins</span>
<span class="sd">        Default is 0.01 (1% margin).</span>
<span class="sd">    colormap : str, optional</span>
<span class="sd">        Matplotlib colormap name, by default &#39;viridis&#39;.</span>
<span class="sd">    hex_color : str, optional</span>
<span class="sd">        Color for hexagon boundary. Can use shorthand or full name.</span>
<span class="sd">        Common shorthands: &#39;k&#39; (black), &#39;r&#39; (red), &#39;b&#39; (blue), &#39;g&#39; (green).</span>
<span class="sd">        Default is &#39;r&#39;.</span>
<span class="sd">    hex_style : str, optional</span>
<span class="sd">        Line style for hexagon. Options: [&#39;-&#39;, &#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">        Default is &#39;--&#39; (dashed).</span>
<span class="sd">    hex_width : float, optional</span>
<span class="sd">        Width of hexagon boundary line, by default 0.5.</span>
<span class="sd">    view_elevation : float, optional</span>
<span class="sd">        Elevation angle for 3D view, by default 30.</span>
<span class="sd">    view_azimuth : float, optional</span>
<span class="sd">        Azimuth angle for 3D view, by default 45.</span>
<span class="sd">    dpi : int, optional</span>
<span class="sd">        Resolution of saved figures in dots per inch, by default 1200.</span>
<span class="sd">    show_axes : bool, optional</span>
<span class="sd">        Whether to show axes and ticks, by default True.</span>
<span class="sd">    output_dir : str, optional</span>
<span class="sd">        Directory to save the figures, by default &#39;Plots&#39;.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function automatically creates the output directory if it doesn&#39;t exist.</span>
<span class="sd">    Uses the publication style settings from set_publication_style().</span>
<span class="sd">    Points outside the hexagon are masked with NaN values.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Create hexagon with constant density</span>
<span class="sd">    &gt;&gt;&gt; hex_geom = {&#39;polygon&#39;: create_hexagon(center=(0, 0), radius=1)}</span>
<span class="sd">    &gt;&gt;&gt; constant_density = lambda x, y: np.ones_like(x)</span>
<span class="sd">    &gt;&gt;&gt; plot_density_hexagon(</span>
<span class="sd">    ...     hex_geom,</span>
<span class="sd">    ...     constant_density,</span>
<span class="sd">    ...     &#39;hex_density&#39;,</span>
<span class="sd">    ...     hex_color=&#39;blue&#39;,</span>
<span class="sd">    ...     colormap=&#39;plasma&#39;</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="n">valid_line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">hex_style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line style must be one of: </span><span class="si">{</span><span class="n">valid_line_styles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">resolution</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;resolution must be at least 10&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">density_function</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;density_function must be callable&quot;</span><span class="p">)</span>

    <span class="c1"># Setup</span>
    <span class="n">set_publication_style</span><span class="p">()</span>
    <span class="n">hex_polygon</span> <span class="o">=</span> <span class="n">hexagon_geometry</span><span class="p">[</span><span class="s1">&#39;polygon&#39;</span><span class="p">]</span>

    <span class="c1"># Get domain bounds</span>
    <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">hex_polygon</span><span class="o">.</span><span class="n">bounds</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Create mask for points inside hexagon</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hex_polygon</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">density_function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="c1"># Prepare file names</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">figure_name</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>

    <span class="c1"># Plot 2D Heatmap</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> 
                                                  <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
    <span class="c1"># Set margins for 2D plot</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">heatmap</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">heatmap</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Draw hexagon boundary</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hex_polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hex_color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">hex_style</span><span class="p">,</span> 
            <span class="n">linewidth</span><span class="o">=</span><span class="n">hex_width</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s1">_2DHeatmap</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Plot 3D Surface</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> 
                                           <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
    <span class="n">ax3d</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

    <span class="c1"># Set margins for 3D plot</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">surface</span> <span class="o">=</span> <span class="n">ax3d</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
                               <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3d</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">ax3d</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_elevation</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_azimuth</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s1">_3DSurface</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<span class="c1"># Plotting the modified Vroronoi cells with the introduced gaps</span>
<div class="viewcode-block" id="plot_voronoi_cells_with_gaps">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.plot_voronoi_cells_with_gaps">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_voronoi_cells_with_gaps</span><span class="p">(</span>
    <span class="n">original_cells</span><span class="p">,</span>
    <span class="n">adjusted_cells</span><span class="p">,</span>
    <span class="n">figure_name</span><span class="p">,</span>
    <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cell_color</span><span class="o">=</span><span class="s1">&#39;#1B365D&#39;</span><span class="p">,</span>
    <span class="n">cell_style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">cell_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">gap_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">gap_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">margins</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
    <span class="n">show_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot Voronoi cells with highlighted gaps between adjacent cells.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    original_cells : list</span>
<span class="sd">        List of shapely.geometry.Polygon objects representing original Voronoi cells</span>
<span class="sd">        before adjustment.</span>
<span class="sd">    adjusted_cells : list</span>
<span class="sd">        List of shapely.geometry.Polygon objects representing adjusted Voronoi cells</span>
<span class="sd">        with gaps.</span>
<span class="sd">    figure_name : str</span>
<span class="sd">        Name of the output figure. If no extension provided, &#39;.png&#39; is used.</span>
<span class="sd">    show_figure : bool, optional</span>
<span class="sd">        Whether to display the figure, by default True.</span>
<span class="sd">    cell_color : str, optional</span>
<span class="sd">        Color for cell boundaries. Can use shorthand or full name.</span>
<span class="sd">        Common shorthands: &#39;k&#39; (black), &#39;r&#39; (red), &#39;b&#39; (blue), &#39;g&#39; (green).</span>
<span class="sd">        Default is &#39;k&#39;.</span>
<span class="sd">    cell_style : str, optional</span>
<span class="sd">        Line style for cell boundaries. Options: [&#39;-&#39;, &#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">        Default is &#39;-&#39; (solid).</span>
<span class="sd">    cell_width : float, optional</span>
<span class="sd">        Width of cell boundary lines, by default 0.5.</span>
<span class="sd">    gap_color : str, optional</span>
<span class="sd">        Color to fill the gaps between cells, by default &#39;lightgray&#39;.</span>
<span class="sd">    gap_alpha : float, optional</span>
<span class="sd">        Transparency of gap filling (0 to 1), by default 0.5.</span>
<span class="sd">    margins : float or tuple, optional</span>
<span class="sd">        Margins around the plot. Can be:</span>
<span class="sd">        - Single float for same margins in x and y</span>
<span class="sd">        - Tuple (x_margin, y_margin) for different margins</span>
<span class="sd">        Default is 0.01 (1% margin in both x and y).</span>
<span class="sd">    dpi : int, optional</span>
<span class="sd">        Resolution of saved figure in dots per inch, by default 1200.</span>
<span class="sd">    show_axes : bool, optional</span>
<span class="sd">        Whether to show axes and ticks, by default False.</span>
<span class="sd">    output_dir : str, optional</span>
<span class="sd">        Directory to save the figure, by default &#39;Plots&#39;.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function automatically creates the output directory if it doesn&#39;t exist.</span>
<span class="sd">    Uses the publication style settings from set_publication_style().</span>
<span class="sd">    Gaps are visualized by plotting the difference between original and adjusted cells.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Plot cells with default gap styling</span>
<span class="sd">    &gt;&gt;&gt; plot_voronoi_cells_with_gaps(</span>
<span class="sd">    ...     original_cells,</span>
<span class="sd">    ...     adjusted_cells,</span>
<span class="sd">    ...     &#39;cells_with_gaps&#39;</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    &gt;&gt;&gt; # Custom styling for cells and gaps</span>
<span class="sd">    &gt;&gt;&gt; plot_voronoi_cells_with_gaps(</span>
<span class="sd">    ...     original_cells,</span>
<span class="sd">    ...     adjusted_cells,</span>
<span class="sd">    ...     &#39;cells_with_gaps&#39;,</span>
<span class="sd">    ...     cell_color=&#39;navy&#39;,</span>
<span class="sd">    ...     gap_color=&#39;lightblue&#39;,</span>
<span class="sd">    ...     gap_alpha=0.3</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="n">valid_line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cell_style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_line_styles</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line style must be one of: </span><span class="si">{</span><span class="n">valid_line_styles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">gap_alpha</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;gap_alpha must be between 0 and 1&quot;</span><span class="p">)</span>

    <span class="c1"># Setup</span>
    <span class="n">set_publication_style</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> 
                                                  <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># Set margins</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># First plot the gaps</span>
    <span class="c1"># Get the union of original and adjusted cells</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">shapely.ops</span><span class="w"> </span><span class="kn">import</span> <span class="n">unary_union</span>
    <span class="n">original_region</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">original_cells</span><span class="p">)</span>
    <span class="n">adjusted_region</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">adjusted_cells</span><span class="p">)</span>
    
    <span class="c1"># The gaps are the difference between original and adjusted regions</span>
    <span class="n">gaps</span> <span class="o">=</span> <span class="n">original_region</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">adjusted_region</span><span class="p">)</span>
    
    <span class="c1"># Plot gaps first (they will be behind the cell boundaries)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gaps</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
        <span class="n">gaps</span> <span class="o">=</span> <span class="n">MultiPolygon</span><span class="p">([</span><span class="n">gaps</span><span class="p">])</span>
    
    <span class="k">for</span> <span class="n">gap</span> <span class="ow">in</span> <span class="n">gaps</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
        <span class="c1"># Fill the gap area</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">gap</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">gap_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">gap_alpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        
        <span class="c1"># Handle any holes in the gaps</span>
        <span class="k">for</span> <span class="n">interior</span> <span class="ow">in</span> <span class="n">gap</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">interior</span><span class="o">.</span><span class="n">xy</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

    <span class="c1"># Then plot the adjusted cells on top</span>
    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">adjusted_cells</span><span class="p">:</span>
        <span class="c1"># Plot cell boundary</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">cell_color</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">cell_style</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">cell_width</span><span class="p">)</span>
        
        <span class="c1"># Plot interior boundaries if any</span>
        <span class="k">for</span> <span class="n">interior</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">interior</span><span class="o">.</span><span class="n">xy</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="n">cell_color</span><span class="p">,</span>
                   <span class="n">linestyle</span><span class="o">=</span><span class="n">cell_style</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="n">cell_width</span><span class="p">)</span>

    <span class="c1"># Handle axes visibility</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Handle figure saving</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">figure_name</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
        <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<span class="c1"># Create a desired grid layout from the provided figures</span>
<div class="viewcode-block" id="create_figure_grid">
<a class="viewcode-back" href="../../../polygen.polygen2d.html#polygen.polygen2d.plotting.create_figure_grid">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_figure_grid</span><span class="p">(</span>
    <span class="n">figure_paths</span><span class="p">,</span>
    <span class="n">output_name</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;1x2&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">label_fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">label_distance</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a publication-quality subplot grid from saved figures.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    figure_paths : list</span>
<span class="sd">        List of paths to individual figure images to be included in the grid.</span>
<span class="sd">    output_name : str</span>
<span class="sd">        Name of the output file. If no extension provided, &#39;.png&#39; is used.</span>
<span class="sd">    layout : str, optional</span>
<span class="sd">        Layout of the grid. Must be one of:</span>
<span class="sd">        - &#39;1x2&#39;: 1 row, 2 columns</span>
<span class="sd">        - &#39;1x3&#39;: 1 row, 3 columns</span>
<span class="sd">        - &#39;2x2&#39;: 2 rows, 2 columns</span>
<span class="sd">        - &#39;2x3&#39;: 2 rows, 3 columns</span>
<span class="sd">        - &#39;3x3&#39;: 3 rows, 3 columns</span>
<span class="sd">        Default is &#39;1x2&#39;.</span>
<span class="sd">    figsize : tuple, optional</span>
<span class="sd">        Custom figure size as (width, height) in inches.</span>
<span class="sd">        If None, uses preset sizes based on layout.</span>
<span class="sd">    show_figure : bool, optional</span>
<span class="sd">        Whether to display the figure, by default True.</span>
<span class="sd">    label_fontsize : float, optional</span>
<span class="sd">        Font size for subplot labels, by default 10.</span>
<span class="sd">    label_distance : float, optional</span>
<span class="sd">        Distance of labels below subplots (in axis units), by default 0.05.</span>
<span class="sd">    dpi : int, optional</span>
<span class="sd">        Resolution of saved figure in dots per inch, by default 1200.</span>
<span class="sd">    output_dir : str, optional</span>
<span class="sd">        Directory to save the figure, by default &#39;Plots&#39;.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If layout is not one of the supported options.</span>
<span class="sd">        If figsize is provided but not a tuple of length 2.</span>
<span class="sd">        If number of figure_paths exceeds subplot count for layout.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function automatically creates the output directory if it doesn&#39;t exist.</span>
<span class="sd">    Uses the publication style settings from set_publication_style().</span>
<span class="sd">    Subplots are labeled alphabetically ((a), (b), etc.) below each figure.</span>
<span class="sd">    Empty subplots are removed if fewer figures than grid spaces.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Create a 1x2 grid from two figures</span>
<span class="sd">    &gt;&gt;&gt; figure_paths = [&#39;figure1.png&#39;, &#39;figure2.png&#39;]</span>
<span class="sd">    &gt;&gt;&gt; create_figure_grid(</span>
<span class="sd">    ...     figure_paths,</span>
<span class="sd">    ...     &#39;combined_figure&#39;,</span>
<span class="sd">    ...     layout=&#39;1x2&#39;,</span>
<span class="sd">    ...     label_fontsize=12</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    &gt;&gt;&gt; # Create a 2x2 grid with custom size</span>
<span class="sd">    &gt;&gt;&gt; figure_paths = [&#39;fig1.png&#39;, &#39;fig2.png&#39;, &#39;fig3.png&#39;, &#39;fig4.png&#39;]</span>
<span class="sd">    &gt;&gt;&gt; create_figure_grid(</span>
<span class="sd">    ...     figure_paths,</span>
<span class="sd">    ...     &#39;quad_figure&#39;,</span>
<span class="sd">    ...     layout=&#39;2x2&#39;,</span>
<span class="sd">    ...     figsize=(10, 10)</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Input validation</span>
    <span class="n">layout_configs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;1x2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;figsize&#39;</span><span class="p">:</span> <span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;1x2&#39;</span><span class="p">,</span> 
                                                 <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)}),</span>
        <span class="s1">&#39;1x3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;figsize&#39;</span><span class="p">:</span> <span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;1x3&#39;</span><span class="p">,</span> 
                                                 <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)}),</span>
        <span class="s1">&#39;2x2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;figsize&#39;</span><span class="p">:</span> <span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;2x2&#39;</span><span class="p">,</span> 
                                                 <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)}),</span>
        <span class="s1">&#39;2x3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;figsize&#39;</span><span class="p">:</span> <span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;2x3&#39;</span><span class="p">,</span> 
                                                 <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)}),</span>
        <span class="s1">&#39;3x3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;figsize&#39;</span><span class="p">:</span> <span class="n">get_figure_size</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;3x3&#39;</span><span class="p">,</span> 
                                                 <span class="n">journal_type</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)})</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">layout</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layout_configs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Layout must be one of: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">layout_configs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="n">layout_configs</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span>
    <span class="n">max_subplots</span> <span class="o">=</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">cols</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">figure_paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_subplots</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of figures (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">figure_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">) exceeds &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;subplot count (</span><span class="si">{</span><span class="n">max_subplots</span><span class="si">}</span><span class="s2">) for layout </span><span class="si">{</span><span class="n">layout</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figsize</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">figsize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;figsize must be a tuple of (width, height)&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">figsize</span>

    <span class="c1"># Setup</span>
    <span class="n">set_publication_style</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Plot figures</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">figure_paths</span><span class="p">)):</span>
        <span class="c1"># Load and display image</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
        <span class="c1"># Add subplot label</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">label_distance</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="mi">97</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">idx</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="c1"># Remove empty subplots</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">figure_paths</span><span class="p">):]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Handle figure saving</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">output_name</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="s2">&quot;.png&quot;</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">base_name</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>
        <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show_figure</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Md Jalal Uddin Rumi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>